# Apache sites-available sample for omraaj.com/bc-screener-research
# Purpose: Expose the SPA running in Docker (mapped to host port 8080) at the
#          path /bc-screener-research on omraaj.com for both HTTP and HTTPS.
#
# How to use on Ubuntu/Debian with Apache 2.4:
#   sudo a2enmod proxy proxy_http headers rewrite ssl
#   # If you expect WebSockets, also:
#   # sudo a2enmod proxy_wstunnel
#   sudo mkdir -p /etc/apache2/sites-available
#   sudo cp bc-screener-research_1.conf /etc/apache2/sites-available/
#   sudo a2ensite bc-screener-research_1
#   sudo systemctl reload apache2
#
# Notes:
# - This config assumes your Docker Compose maps the container to host port 8080:
#     services.web.ports: - "8080:80"
#   Adjust the ProxyPass target if your port differs.
# - The SPA is already configured to handle client-side routing at the backend
#   via .htaccess inside the container. We proxy all requests under the prefix.
# - If omraaj.com already has another vhost, merge the <Location> section below
#   into that site instead of using a separate vhost file.

# Optional: If you have multiple hostnames, add ServerAlias lines as needed.
# Replace with your real admin email if you want.

######################################################################
# HTTP (non-SSL)
######################################################################
# HTTP
<VirtualHost *:80>
  ServerName bc-screener-research.omraaj.com
  ServerAdmin ashwin.mecon@gmail.com

  # Optional: force HTTPS (leave ACME path open)
  RewriteEngine On
  RewriteCond %{REQUEST_URI} !^/.well-known/acme-challenge/
  RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

  AllowEncodedSlashes NoDecode
  ProxyPreserveHost On
  RequestHeader set X-Forwarded-Proto "http"
  RequestHeader set X-Forwarded-Host  "bc-screener-research.omraaj.com"

  ProxyPass        / http://127.0.0.1:8080/ connectiontimeout=5 timeout=60 keepalive=On
  ProxyPassReverse / http://127.0.0.1:8080/
  ProxyPassReverseCookieDomain 127.0.0.1 bc-screener-research.omraaj.com

  ErrorLog  ${APACHE_LOG_DIR}/bc-screener-research-error.log
  CustomLog ${APACHE_LOG_DIR}/bc-screener-research-access.log combined
</VirtualHost>

# HTTPS
<VirtualHost *:443>
  ServerName bc-screener-research.omraaj.com
  ServerAdmin ashwin.mecon@gmail.com

  SSLEngine on
  SSLCertificateFile    /etc/letsencrypt/live/bc-screener-research.omraaj.com/fullchain.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/bc-screener-research.omraaj.com/privkey.pem

  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains" env=HTTPS
  Header always set X-Content-Type-Options nosniff
  Header always set X-Frame-Options SAMEORIGIN
  Header always set Referrer-Policy no-referrer-when-downgrade
  Header always set X-XSS-Protection "1; mode=block"

  AllowEncodedSlashes NoDecode
  ProxyPreserveHost On
  RequestHeader set X-Forwarded-Proto "https"
  RequestHeader set X-Forwarded-Host  "bc-screener-research.omraaj.com"

  ProxyPass        / http://127.0.0.1:8080/ connectiontimeout=5 timeout=60 keepalive=On
  ProxyPassReverse / http://127.0.0.1:8080/
  ProxyPassReverseCookieDomain 127.0.0.1 bc-screener-research.omraaj.com

  ErrorLog  ${APACHE_LOG_DIR}/bc-screener-research-ssl-error.log
  CustomLog ${APACHE_LOG_DIR}/bc-screener-research-ssl-access.log combined
</VirtualHost>

